<ul class="list bg-base-300 rounded-box shadow-md">

  @for (item of purchases(); track $index) {
    <li class="list-row flex flex-col gap-2">
      <!-- Fila principal -->
      <div class="flex items-center gap-4">
        <div>
          <img [src]="imageList()[$index]" alt="imagen" class="h-30" />
        </div>

        <div class="flex-1">
          <div class="font-bold font-montserrat-md text-2xl">
            {{ item.vehicle.make }} {{ item.vehicle.model }}
          </div>
        </div>

        <div>
          {{ ventas()[$index]['date'] | date }}
        </div>
      </div>

      @if (!item.rated) {
        <form [formGroup]="form" (ngSubmit)="submit(ventas()[$index]['ref_vehicle_vin'])">
          <details class="collapse rounded-none">
            <summary class="collapse-title font-bold text-primary text-xl">
              Valorar <fa-icon [icon]="arrowDown" />
            </summary>

            <div class="collapse-content text-sm bg-base-100 border border-base-300 pt-3 flex flex-col gap-5">

              <div>
                <span class="font-bold">Puntuaci√≥n:</span>
                <div class="rating rating-lg">
                  <input type="radio" class="rating-hidden" />

                  <input type="radio" class="mask mask-star-2"
                        value="1" formControlName="rating" />
                  <input type="radio" class="mask mask-star-2"
                        value="2" formControlName="rating" />
                  <input type="radio" class="mask mask-star-2"
                        value="3" formControlName="rating" />
                  <input type="radio" class="mask mask-star-2"
                        value="4" formControlName="rating" />
                  <input type="radio" class="mask mask-star-2"
                        value="5" formControlName="rating" />
                </div>
              </div>

              <div class="flex justify-between items-end">
                <textarea
                  class="textarea resize-none w-1/2"
                  placeholder="Comentario (opcional)"
                  formControlName="comment">
                </textarea>

                <button type="submit" class="btn btn-primary">
                  Publicar
                </button>
              </div>

            </div>
          </details>
        </form>
      }

    </li>
  }
</ul>

@if(valoracion()!=null){
  @if(valoracion()){
    <div role="alert" class="absolute bottom-5 right-5 alert alert-success">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>Valoracion Realizada!</span>
    </div>
  }
  @else {
    <div role="alert" class="absolute bottom-5 right-5 alert alert-error">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 shrink-0 stroke-current" fill="none" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <span>Error! No se ha realizado la valoracion.</span>
    </div>
  }
}
